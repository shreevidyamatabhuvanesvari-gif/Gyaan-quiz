<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</title>

<style>
body{
  margin:0;
  font-family:system-ui,"Noto Sans Devanagari",sans-serif;
  background:#fff3ea;
}
.container{
  max-width:520px;
  margin:auto;
  padding:16px;
}
h1{
  text-align:center;
  color:#8b2d2d;
}
.status{
  background:#fff;
  border-radius:12px;
  padding:10px;
  text-align:center;
  margin-bottom:12px;
  border:1px solid #e6b2b2;
}
.chat{
  background:#fff;
  border-radius:14px;
  padding:12px;
  min-height:280px;
  max-height:50vh;
  overflow:auto;
  border:1px solid #f3d4c7;
}
.msg{
  margin-bottom:10px;
}
.user{ color:#333; }
.bot{ color:#8b2d2d; }

.actions{
  margin-top:12px;
  display:flex;
  gap:10px;
}
button{
  flex:1;
  border:none;
  border-radius:14px;
  padding:12px;
  font-size:15px;
  cursor:pointer;
  background:#a13f3f;
  color:#fff;
}
button.secondary{
  background:#fff;
  color:#8b2d2d;
  border:1px dashed #e6b2b2;
}
</style>
</head>

<body>
<div class="container">

<h1>üå∏ ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</h1>

<div class="status" id="status">‡§§‡•à‡§Ø‡§æ‡§∞</div>

<div class="chat" id="chat"></div>

<div class="actions">
  <button id="listenBtn">üé§ ‡§¨‡•ã‡§≤‡•á‡§Ç</button>
  <button class="secondary" onclick="goBack()">‚¨Ö ‡§µ‡§æ‡§™‡§∏</button>
</div>

</div>

<!-- ========== CORE / BRAIN ========== -->
<script src="core/AmbiguityResolver.js"></script>
<script src="core/ThinkingEngine.js"></script>
<script src="core/ContextMemory.js"></script>

<!-- ========== LEARNING / KNOWLEDGE ========== -->
<script src="learning/KnowledgeReader.js"></script>
<script src="learning/KnowledgeBase.js"></script>
<script src="learning/ExperienceMemory.js"></script>

<!-- ========== ANSWER ========== -->
<script src="answer/KnowledgeAnswerEngine.js"></script>
<script src="answer/ResponseEngine.js"></script>

<!-- ========== VOICE ========== -->
<script src="voice/tts.js"></script>
<script src="voice/commandBuffer.js"></script>
<script src="voice/stt.js"></script>

<script>
/* ===============================
   UI HELPERS
   =============================== */
const chat = document.getElementById("chat");
const status = document.getElementById("status");

function addMsg(text, cls){
  const div=document.createElement("div");
  div.className="msg "+cls;
  div.innerText=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

/* ===============================
   NAV
   =============================== */
function goBack(){
  window.location.href="index.html";
}

/* ===============================
   START LISTEN
   =============================== */
listenBtn.onclick = ()=>{
  if(!window.AnjaliSTT){
    alert("Listening engine ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");
    return;
  }
  status.innerText="üé§ ‡§∏‡•Å‡§® ‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å‚Ä¶";
  AnjaliSTT.startListening();
};

/* ===============================
   STT ‚Üí THINK ‚Üí SPEAK
   =============================== */
if(window.AnjaliSTT){
  AnjaliSTT.onText = function(userText){
    if(!userText) return;

    addMsg("‡§Ü‡§™: "+userText,"user");

    const result = ThinkingEngine.think(userText);

    if(result?.clarify){
      AnjaliTTS.speak("‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§•‡•ã‡§°‡§º‡§æ ‡§î‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§");
      addMsg("‡§Ö‡§Ç‡§ú‡§≤‡•Ä: ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç","bot");
      return;
    }

    if(result?.text){
      addMsg("‡§Ö‡§Ç‡§ú‡§≤‡•Ä: "+result.text,"bot");

      AnjaliTTS.speak(result.text,{},()=>{
        if(window.ContextMemory){
          ContextMemory.add(userText,result.text);
        }
        if(window.ExperienceMemory){
          ExperienceMemory.recordConversation(userText,result.text);
        }
      });
      return;
    }

    addMsg("‡§Ö‡§Ç‡§ú‡§≤‡•Ä: ‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§Ö‡§≠‡•Ä ‡§Æ‡•á‡§∞‡•á ‡§™‡§æ‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§","bot");
    AnjaliTTS.speak("‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§Ö‡§≠‡•Ä ‡§Æ‡•á‡§∞‡•á ‡§™‡§æ‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§");
  };
}
</script>

</body>
  </html>
