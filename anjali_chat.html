<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç ‚Ä¢ Gyaan-Quiz</title>

<style>
:root{
  --bg1:#fdf4ec;
  --bg2:#fde2cf;
  --accent:#7a1f1f;
  --soft:#b85c5c;
  --card:#ffffff;
  --user:#fff1e6;
  --anjali:#f7fbff;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  font-family:system-ui,"Noto Sans Devanagari",sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;
  align-items:center;
  justify-content:center;
}
.chat-card{
  width:96%;
  max-width:460px;
  height:92vh;
  background:var(--card);
  border-radius:24px;
  box-shadow:0 18px 40px rgba(0,0,0,.15);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.header{
  padding:14px 16px;
  background:linear-gradient(180deg,#c96a6a,#9e3b3b);
  color:#fff;
  text-align:center;
}
.header b{font-size:18px}
.header small{display:block;font-size:12px;opacity:.9}
.chat{
  flex:1;
  padding:14px;
  overflow-y:auto;
  background:#fffdfb;
}
.msg{
  max-width:82%;
  padding:10px 12px;
  margin-bottom:10px;
  border-radius:14px;
  font-size:14px;
  line-height:1.5;
}
.msg.user{
  background:var(--user);
  margin-left:auto;
  border-bottom-right-radius:4px;
}
.msg.anjali{
  background:var(--anjali);
  margin-right:auto;
  border-bottom-left-radius:4px;
}
.system{
  text-align:center;
  font-size:12px;
  color:#777;
  margin:8px 0;
}
.footer{
  padding:12px;
  border-top:1px solid #eee;
  background:#fff;
}
.controls{
  display:flex;
  gap:10px;
}
.btn{
  flex:1;
  border:none;
  border-radius:16px;
  padding:12px;
  font-size:14px;
  cursor:pointer;
  background:linear-gradient(180deg,#c96a6a,#9e3b3b);
  color:#fff;
}
.btn.secondary{
  background:#fff;
  color:var(--soft);
  border:1px dashed #e6b2b2;
}
</style>
</head>

<body>
<main class="chat-card">

  <div class="header">
    <b>üå∏ ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</b>
    <small>‡§ú‡•ç‡§û‡§æ‡§® ‚Ä¢ ‡§∏‡§Ç‡§µ‡§æ‡§¶ ‚Ä¢ ‡§∏‡§Æ‡§ù</small>
  </div>

  <div class="chat" id="chatBox">
    <div class="system">üé§ ‚Äú‡§¨‡•ã‡§≤‡•á‡§Ç‚Äù ‡§¶‡§¨‡§æ‡§á‡§è ‡§î‡§∞ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡§ø‡§è</div>
  </div>

  <div class="footer">
    <div class="controls">
      <button class="btn" id="listenBtn">üé§ ‡§¨‡•ã‡§≤‡•á‡§Ç</button>
      <button class="btn secondary" id="backBtn">‚¨Ö ‡§µ‡§æ‡§™‡§∏</button>
    </div>
  </div>

</main>

<!-- ================= CORE ================= -->
<script src="core/ThinkingEngine.js"></script>

<!-- ================= VOICE ================= -->
<script src="voice/tts.js"></script>
<script src="voice/stt.js"></script>

<script>
/* ================= UI HELPERS ================= */
const chatBox = document.getElementById("chatBox");
const listenBtn = document.getElementById("listenBtn");
const backBtn = document.getElementById("backBtn");

function addMsg(text, who){
  const d = document.createElement("div");
  d.className = "msg " + who;
  d.innerText = text;
  chatBox.appendChild(d);
  chatBox.scrollTop = chatBox.scrollHeight;
}
function addSys(text){
  const d = document.createElement("div");
  d.className = "system";
  d.innerText = text;
  chatBox.appendChild(d);
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* ================= NAV ================= */
backBtn.onclick = () => location.href="index.html";

/* ================= üîó ‡§®‡§ø‡§∞‡•ç‡§£‡§æ‡§Ø‡§ï FIX =================
   Admin Panel ‡§ï‡§æ ‡§ú‡•ç‡§û‡§æ‡§® ThinkingEngine ‡§Æ‡•á‡§Ç ‡§≤‡•ã‡§°
   ================================================ */
const ADMIN_KEY = "ANJALI_ADMIN_KNOWLEDGE_V1";

(function loadAdminKnowledge(){
  if (!window.ThinkingEngine) return;

  let data = [];
  try{
    data = JSON.parse(localStorage.getItem(ADMIN_KEY)) || [];
  }catch(e){ data = []; }

  data.forEach(item=>{
    if (!item.q || !item.a) return;

    ThinkingEngine.teach(item.q, item.a);
  });
})();

/* ================= CHAT START ================= */
listenBtn.onclick = () => {

  if (!window.AnjaliSTT || !AnjaliSTT.available) {
    addSys("‚ùå Listening engine ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");
    return;
  }

  // üîë mic unlock (user gesture)
  AnjaliSTT.unlock();

  AnjaliSTT.onText = function(userText){
    addMsg(userText, "user");

    const result = ThinkingEngine.think(userText);

    if (result?.text) {
      addMsg(result.text, "anjali");
      if (window.AnjaliTTS) {
        AnjaliTTS.speak(result.text);
      }
    } else {
      addMsg("‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§Ö‡§≠‡•Ä ‡§Æ‡•á‡§∞‡•á ‡§™‡§æ‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§", "anjali");
    }
  };

  addSys("üé§ ‡§∏‡•Å‡§® ‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å‚Ä¶");
  AnjaliSTT.start();
};
</script>

</body>
</html>
