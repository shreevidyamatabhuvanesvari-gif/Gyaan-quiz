<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç ‚Ä¢ Gyaan-Quiz</title>

<style>
:root{
  --bg1:#fdf4ec;
  --bg2:#fde2cf;
  --accent:#7a1f1f;
  --soft:#b85c5c;
  --card:#ffffff;
  --user:#fff1e6;
  --anjali:#f7fbff;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  font-family:system-ui,"Noto Sans Devanagari",sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;
  align-items:center;
  justify-content:center;
}
.chat-card{
  width:96%;
  max-width:460px;
  height:92vh;
  background:var(--card);
  border-radius:24px;
  box-shadow:0 18px 40px rgba(0,0,0,.15);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* HEADER */
.header{
  padding:14px 16px;
  background:linear-gradient(180deg,#c96a6a,#9e3b3b);
  color:#fff;
  text-align:center;
}
.header b{font-size:18px}
.header small{display:block;font-size:12px;opacity:.9}

/* CHAT AREA */
.chat{
  flex:1;
  padding:14px;
  overflow-y:auto;
  background:#fffdfb;
}
.msg{
  max-width:82%;
  padding:10px 12px;
  margin-bottom:10px;
  border-radius:14px;
  font-size:14px;
  line-height:1.5;
}
.msg.user{
  background:var(--user);
  margin-left:auto;
  border-bottom-right-radius:4px;
}
.msg.anjali{
  background:var(--anjali);
  margin-right:auto;
  border-bottom-left-radius:4px;
}
.system{
  text-align:center;
  font-size:12px;
  color:#777;
  margin:8px 0;
}

/* FOOTER */
.footer{
  padding:12px;
  border-top:1px solid #eee;
  background:#fff;
}
.controls{
  display:flex;
  gap:10px;
}
.btn{
  flex:1;
  border:none;
  border-radius:16px;
  padding:12px;
  font-size:14px;
  cursor:pointer;
  background:linear-gradient(180deg,#c96a6a,#9e3b3b);
  color:#fff;
}
.btn.secondary{
  background:#fff;
  color:var(--soft);
  border:1px dashed #e6b2b2;
}

/* SCROLLBAR (SOFT) */
.chat::-webkit-scrollbar{width:6px}
.chat::-webkit-scrollbar-thumb{
  background:#e5c1c1;
  border-radius:6px;
}
</style>
</head>

<body>
<main class="chat-card">

  <!-- HEADER -->
  <div class="header">
    <b>üå∏ ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</b>
    <small>‡§ú‡•ç‡§û‡§æ‡§® ‚Ä¢ ‡§∏‡§Ç‡§µ‡§æ‡§¶ ‚Ä¢ ‡§∏‡§Æ‡§ù</small>
  </div>

  <!-- CHAT MESSAGES -->
  <div class="chat" id="chatBox">
    <div class="system">üé§ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‚Äú‡§¨‡•ã‡§≤‡•á‡§Ç‚Äù ‡§¶‡§¨‡§æ‡§è‡§Å</div>
  </div>

  <!-- FOOTER CONTROLS -->
  <div class="footer">
    <div class="controls">
      <button class="btn" id="listenBtn">üé§ ‡§¨‡•ã‡§≤‡•á‡§Ç</button>
      <button class="btn secondary" id="backBtn">‚¨Ö ‡§µ‡§æ‡§™‡§∏</button>
    </div>
  </div>

</main>

<script>
/* ===============================
   UI HELPERS
   =============================== */
const chatBox = document.getElementById("chatBox");

function addMessage(text, who){
  const div = document.createElement("div");
  div.className = "msg " + who;
  div.innerText = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function addSystem(text){
  const div = document.createElement("div");
  div.className = "system";
  div.innerText = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* ===============================
   NAVIGATION
   =============================== */
document.getElementById("backBtn").onclick = () => {
  location.href = "index.html";
};

/* ===============================
   CONVERSATION FLOW (SAFE)
   =============================== */
document.getElementById("listenBtn").onclick = () => {

  if (!window.AnjaliSTT) {
    addSystem("‚ùå Listening engine ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");
    return;
  }

  addSystem("üé§ ‡§∏‡•Å‡§® ‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å‚Ä¶");

  // Hook once (safe)
  if (!AnjaliSTT._chatHooked) {
    AnjaliSTT._chatHooked = true;

    AnjaliSTT.onText = function(userText){
      addMessage(userText, "user");

      if (!window.ThinkingEngine) {
        addMessage("‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ã‡§ö ‡§á‡§Ç‡§ú‡§® ‡§Ö‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§", "anjali");
        return;
      }

      const result = ThinkingEngine.think(userText);

      if (result?.clarify) {
        addMessage("‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§•‡•ã‡§°‡§º‡§æ ‡§î‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§", "anjali");
        return;
      }

      if (result?.text) {
        addMessage(result.text, "anjali");

        if (window.AnjaliTTS) {
          AnjaliTTS.speak(result.text);
        }
        return;
      }

      addMessage("‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§Ö‡§≠‡•Ä ‡§Æ‡•á‡§∞‡•á ‡§™‡§æ‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§", "anjali");
    };
  }

  AnjaliSTT.start();
};
</script>

</body>
</html>
