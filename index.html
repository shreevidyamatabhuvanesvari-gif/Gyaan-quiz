<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡§Ö‡§Ç‡§ú‡§≤‡•Ä</title>

<style>
:root{
  --bg1:#fff3ea;--bg2:#ffe1cf;--accent:#8b2d2d;
  --soft:#b35c5c;--card:#ffffff;
}
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;
  font-family:system-ui,"Noto Sans Devanagari",sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;align-items:center;justify-content:center;
}
.card{
  width:94%;max-width:440px;background:var(--card);
  border-radius:22px;padding:20px;
  box-shadow:0 14px 30px rgba(0,0,0,.12);
  text-align:center;
}
.title{font-size:26px;color:var(--accent)}
.subtitle{font-size:14px;color:#555;margin-bottom:12px}
.status{
  background:#fff7f4;border:1px solid #f3d4c7;
  border-radius:14px;padding:10px;font-size:13px;
  margin:8px 0;color:#6b2c2c;
}
.actions{
  display:flex;gap:10px;justify-content:center;
  flex-wrap:wrap;margin-top:10px;
}
.btn{
  border:none;border-radius:16px;
  padding:12px 16px;font-size:14px;cursor:pointer;
  background:linear-gradient(180deg,#c96a6a,#a13f3f);
  color:#fff;
}
.btn.secondary{
  background:#fff;color:var(--soft);
  border:1px dashed #e6b2b2;
}

/* ===== QUIZ ===== */
.quiz-box{
  margin-top:14px;
  padding:14px;
  border-radius:16px;
  background:#fff7f4;
  border:1px solid #f3d4c7;
  display:none;
}
.quiz-q{font-weight:bold;margin-bottom:8px}
.quiz-a{
  margin-top:10px;
  padding:8px;
  background:#fff;
  border-radius:10px;
  color:#333;
  display:none;
}
.quiz-timer{
  font-size:22px;font-weight:bold;color:#a13f3f;
}
.footer{font-size:11px;color:#777;margin-top:12px}
</style>
</head>

<body>
<main class="card">

<div class="title">‡§Ö‡§Ç‡§ú‡§≤‡•Ä</div>
<div class="subtitle">‡§∏‡•ç‡§®‡•á‡§π‡§™‡•Ç‡§∞‡•ç‡§£ ‚Ä¢ ‡§∏‡§Æ‡§ù‡§¶‡§æ‡§∞ ‚Ä¢ ‡§Æ‡§∞‡•ç‡§Ø‡§æ‡§¶‡§ø‡§§</div>

<div class="status" id="appStatus">‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à</div>

<div class="actions">
  <button class="btn" id="startBtn">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
  <button class="btn" id="quizBtn">üß† Quiz</button>
  <button class="btn secondary" id="adminBtn">üîê Admin</button>
</div>

<!-- QUIZ UI -->
<div class="quiz-box" id="quizBox">
  <div class="quiz-q" id="quizQ"></div>
  <div>‚è≥ ‡§∏‡§Æ‡§Ø ‡§∂‡•á‡§∑</div>
  <div class="quiz-timer" id="quizTimer">5</div>
  <div class="quiz-a" id="quizA"></div>
</div>

<div class="footer">Core-Stable ‚Ä¢ Quiz-Verified</div>

<!-- ================= CORE ================= -->
<script src="core/AmbiguityResolver.js"></script>
<script src="core/ThinkingEngine.js"></script>
<script src="core/ContextMemory.js"></script>

<!-- ================= LEARNING ================= -->
<script src="learning/KnowledgeBase.js"></script>
<script src="learning/ExperienceMemory.js"></script>

<!-- ================= ANSWER ================= -->
<script src="answer/KnowledgeAnswerEngine.js"></script>

<!-- ================= VOICE ================= -->
<script src="voice/tts.js"></script>
<script src="voice/stt.js"></script>

<!-- ================= PRESENCE ================= -->
<script src="presence/AnjaliPresence.js"></script>

<!-- ================= MAIN ================= -->
<script src="main.js"></script>

<script>
/* ========== BASIC UI ========== */
adminBtn.onclick = () => location.href="admin.html";
startBtn.onclick = () => appStatus.innerText="‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§π‡•à‚Ä¶";

/* ========== QUIZ ENGINE (HARDENED) ========== */
const QUIZ_KEY = "ANJALI_ADMIN_KNOWLEDGE_V1";

let quizData = [];
let quizIndex = 0;
let timerRef = null;

quizBtn.onclick = () => {
  // full reset
  clearInterval(timerRef);
  speechSynthesis.cancel();

  const raw = JSON.parse(localStorage.getItem(QUIZ_KEY) || "[]");
  if (!Array.isArray(raw) || raw.length === 0) {
    alert("Quiz ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§");
    return;
  }
  quizData = raw;
  quizIndex = 0;
  quizBox.style.display = "block";
  appStatus.innerText = "Quiz ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶";
  runQuiz();
};

function runQuiz(){
  if (quizIndex >= quizData.length) {
    quizBox.style.display = "none";
    quizQ.innerText = "";
    quizA.innerText = "";
    appStatus.innerText = "Quiz ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•Å‡§Ü";
    return;
  }

  const item = quizData[quizIndex] || {};
  const qText = item.q || "‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç";
  const aText = item.a || "‡§â‡§§‡•ç‡§§‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç";

  quizQ.innerText = "‚ùì " + qText;
  quizA.innerText = "‚úÖ ‡§â‡§§‡•ç‡§§‡§∞: " + aText;
  quizA.style.display = "none";

  let t = 5;
  quizTimer.innerText = t;

  clearInterval(timerRef);
  timerRef = setInterval(() => {
    t--;
    quizTimer.innerText = t;

    if (t <= 0) {
      clearInterval(timerRef);

      quizA.style.display = "block";

      // üîä TTS
      if (window.speechSynthesis) {
        const u = new SpeechSynthesisUtterance(aText);
        u.lang = "hi-IN";
        u.rate = 0.75;
        u.pitch = 1.05;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
      }

      // future-safe learning hook
      if (window.ExperienceMemory?.recordQuizExposure) {
        ExperienceMemory.recordQuizExposure(qText);
      }

      setTimeout(() => {
        quizIndex++;
        runQuiz();
      }, 2000);
    }
  }, 1000);
}
</script>

</main>
</body>
</html>
