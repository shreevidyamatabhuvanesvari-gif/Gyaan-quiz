<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel ‚Ä¢ ‡§Ö‡§Ç‡§ú‡§≤‡•Ä</title>

  <style>
    body{
      margin:0;
      font-family:"Noto Sans Devanagari", system-ui, sans-serif;
      background:#f4f6f8;
      color:#111;
    }
    header{
      background:#1f2937;
      color:#fff;
      padding:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    header button{
      border:none;
      padding:8px 14px;
      border-radius:10px;
      background:#2563eb;
      color:#fff;
      cursor:pointer;
      font-size:14px;
    }
    main{
      padding:14px;
      display:flex;
      gap:14px;
      flex-wrap:wrap;
    }
    .panel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 6px 18px rgba(0,0,0,.1);
    }
    .form-panel{
      flex:1;
      min-width:280px;
      max-width:520px;
    }
    .list-panel{
      flex:1;
      min-width:260px;
      max-width:420px;
      max-height:75vh;
      overflow:auto;
    }
    label{
      font-weight:bold;
      display:block;
      margin-top:10px;
      margin-bottom:4px;
    }
    textarea{
      width:100%;
      box-sizing:border-box;
      padding:10px;
      font-size:15px;
      border-radius:10px;
      border:1px solid #ccc;
      resize:vertical;
    }
    .big{ min-height:140px; }
    .actions{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .actions button{
      border:none;
      border-radius:10px;
      padding:8px 14px;
      cursor:pointer;
      font-size:14px;
      background:#16a34a;
      color:#fff;
    }
    .actions .secondary{ background:#64748b; }
    .item{
      border-bottom:1px solid #eee;
      padding:8px 0;
    }
    .item b{
      display:block;
      margin-bottom:6px;
    }
    .item-actions button{
      margin-right:4px;
      border:none;
      border-radius:6px;
      padding:4px 8px;
      font-size:12px;
      cursor:pointer;
    }
    .edit{ background:#2563eb; color:#fff; }
    .delete{ background:#dc2626; color:#fff; }
  </style>
</head>

<body>

<header>
  <div>üîê Admin Panel ‚Ä¢ ‡§Ö‡§Ç‡§ú‡§≤‡•Ä</div>
  <button onclick="goIndex()">‚¨Ö Index</button>
</header>

<main>

  <!-- FORM -->
  <section class="panel form-panel">
    <h2 id="formTitle">‚ûï ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h2>

    <label>‡§™‡•ç‡§∞‡§∂‡•ç‡§®</label>
    <textarea id="q"></textarea>

    <label>‡§â‡§§‡•ç‡§§‡§∞</label>
    <textarea id="a" class="big"></textarea>

    <div class="actions">
      <button onclick="saveItem()">üíæ Save</button>
      <button class="secondary" onclick="cancelEdit()">‚ùå Cancel</button>
    </div>
  </section>

  <!-- LIST -->
  <section class="panel list-panel">
    <h3>üìö ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</h3>
    <div id="list"></div>
  </section>

</main>

<!-- CORE (Safe include) -->
  <script src="AnjaliCore.js"></script>
<script src="core/AmbiguityResolver.js"></script>
<script src="core/ThinkingEngine.js"></script>
<script src="voice/tts.js"></script>
<script>
/* ===============================
   ADMIN STORE
   =============================== */
const ADMIN_KEY = "ANJALI_ADMIN_KNOWLEDGE_V1";
let data = JSON.parse(localStorage.getItem(ADMIN_KEY)) || [];
let editId = null;

function goIndex(){
  location.href = "index.html";
}

/* ===============================
   SAFE THINKING ENGINE SYNC
   =============================== */
function syncToThinkingEngine(item){
  if (!window.ThinkingEngine) return;

  const signals = item.q
    .toLowerCase()
    .replace(/[^\u0900-\u097F\s]/g,"")
    .split(" ")
    .filter(w => w.length > 2);

  ThinkingEngine.addConcept(
    item.id,
    signals,
    () => item.a
  );
}

/* ===============================
   CRUD
   =============================== */
function saveItem(){
  const question = q.value.trim();
  const answer = a.value.trim();

  if(!question || !answer){
    alert("‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§î‡§∞ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à‡§Ç");
    return;
  }

  if(editId){
    const item = data.find(x=>x.id===editId);
    if(item){
      item.q = question;
      item.a = answer;
      syncToThinkingEngine(item);
    }
  } else {
    const item = {
      id: Date.now().toString(),
      q: question,
      a: answer
    };
    data.push(item);
    syncToThinkingEngine(item);
  }

  persist();
  resetForm();
  render();
}

function editItem(id){
  const item = data.find(x=>x.id===id);
  if(!item) return;
  editId = id;
  q.value = item.q;
  a.value = item.a;
  formTitle.innerText = "‚úèÔ∏è ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç";
}

function deleteItem(id){
  if(!confirm("‡§Ø‡§π ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç?")) return;
  data = data.filter(x=>x.id!==id);
  persist();
  render();
}

function cancelEdit(){
  resetForm();
}

function resetForm(){
  q.value="";
  a.value="";
  editId=null;
  formTitle.innerText="‚ûï ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç";
}

function persist(){
  localStorage.setItem(ADMIN_KEY, JSON.stringify(data));
}

function render(){
  list.innerHTML="";
  data.forEach(item=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <b>${item.q}</b>
      <div class="item-actions">
        <button class="edit" onclick="editItem('${item.id}')">Edit</button>
        <button class="delete" onclick="deleteItem('${item.id}')">Delete</button>
      </div>
    `;
    list.appendChild(d);
  });
}

/* ===============================
   INIT: LOAD INTO THINKING ENGINE
   =============================== */
data.forEach(syncToThinkingEngine);
render();
</script>

</body>
</html>
